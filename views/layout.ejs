<!DOCTYPE html>
<html>
  <head>
    <title>E-Gov Portal</title>
    <meta charset="utf-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        display: flex;
        min-height: 100vh;
      }
      .sidebar {
        width: 250px;
        background: #f8f9fa;
        padding: 15px;
        border-right: 1px solid #ddd;
        overflow-y: auto;
      }
      .content {
        flex: 1;
        padding: 20px;
      }
      .sidebar a {
        display: block;
        padding: 6px 0;
        color: #333;
        text-decoration: none;
      }
      .sidebar a:hover {
        text-decoration: underline;
      }
      .notifications {
        background: #fff;
        border: 1px solid #ccc;
        padding: 8px;
        border-radius: 6px;
        max-height: 200px;
        overflow-y: auto;
      }
      .notif-item {
        font-size: 0.9em;
        padding: 4px 0;
        border-bottom: 1px solid #eee;
      }
      .notif-item:last-child {
        border-bottom: none;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h5 class="mb-3">E-Gov Portal</h5>

      <% if (!user) { %>
      <a href="/auth/login">Login</a>
      <a href="/auth/register">Register</a>
      <% } else { %>
      <p class="fw-bold">Hello, <%= user.name %></p>
      <p><small>(<%= user.role %>)</small></p>

      <% if (user.role === 'citizen') { %>
      <a href="/citizen">My Dashboard</a>
      <a href="/citizen/apply">Apply for Service</a>

      <!-- Notifications -->
      <h6 class="mt-3">Notifications</h6>
      <div class="notifications mb-2">
        <% if (notifications.length === 0) { %>
        <p class="text-muted">No notifications</p>
        <% } else { %> <% notifications.forEach(n => { %>
        <div class="notif-item <%= n.is_read ? 'text-muted' : '' %>">
          <% if (!n.is_read) { %>
          <form method="post" action="/citizen/notifications/<%= n.id %>/read">
            <button type="submit" class="btn btn-link p-0 text-start w-100">
              <%= n.message %><br />
              <small class="text-muted"
                ><%= new Date(n.created_at).toLocaleString() %></small
              >
            </button>
          </form>
          <% } else { %> <%= n.message %><br />
          <small class="text-muted"
            ><%= new Date(n.created_at).toLocaleString() %></small
          >
          <% } %>
        </div>
        <% }) %> <% } %>
      </div>

      <a href="/citizen/notifications" class="btn btn-sm btn-link w-100"
        >View All Notifications</a
      >

      <form method="post" action="/citizen/notifications/read" class="mt-1">
        <button type="submit" class="btn btn-sm btn-outline-secondary w-100">
          Mark All as Read
        </button>
      </form>
      <% } %> <% if (user.role === 'officer' || user.role === 'head') { %>
      <a href="/officer">Officer Dashboard</a>
      <% } %> <% if (user.role === 'admin') { %>
      <a href="/admin">Admin Dashboard</a>
      <a href="/admin">Reports</a>
      <% } %>

      <hr />
      <a href="/auth/logout" class="text-danger">Logout</a>
      <% } %>
    </div>

    <!-- Main content -->
    <div class="content"><%- body %></div>
  </body>
</html>
