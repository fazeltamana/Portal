<%- include('../partials/header') %>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-9 col-lg-10 p-5">
      <!-- Page Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-primary">Request Details</h2>
        <a href="/citizen" class="btn btn-secondary px-4 py-2"
          >Back to Dashboard</a
        >
      </div>

      <!-- Request Details Card -->
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-body">
          <h4 class="fw-bold mb-3 text-primary">
            Request #<%= request.id %> â€” <%= request.service_name %>
          </h4>

          <div class="row mb-2">
            <div class="col-md-6">
              <p class="mb-1">
                <strong>Status:</strong>
                <% let status = request.payment_status ||
                request.current_status; %> <% if (status === 'SUBMITTED') { %>
                <span class="badge bg-warning text-dark"><%= status %></span>
                <% } else if (status === 'PAID') { %>
                <span class="badge bg-success"><%= status %></span>
                <% } else if (status === 'PROCESSING') { %>
                <span class="badge bg-info text-dark"><%= status %></span>
                <% } else if (status === 'COMPLETED') { %>
                <span class="badge bg-primary"><%= status %></span>
                <% } else { %>
                <span class="badge bg-secondary"><%= status %></span>
                <% } %>
              </p>
            </div>
            <div class="col-md-6">
              <p class="mb-1">
                <strong>Department:</strong> <%= request.department_name %>
              </p>
            </div>
          </div>

          <p class="mb-0">
            <strong>Fee:</strong>
            <% if (request.fee_cents) { %> $<%= (request.fee_cents /
            100).toFixed(2) %> <% } else { %> - <% } %>
          </p>
        </div>
      </div>

      <!-- Documents Card -->
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Documents</h5>
          <% if (documents.length === 0) { %>
          <p class="text-muted mb-0">No documents uploaded.</p>
          <% } else { %>
          <ul class="list-group list-group-flush">
            <% documents.forEach(d => { %>
            <li class="list-group-item">
              <a
                href="/uploads/<%= d.file_path.split('/').pop() %>"
                target="_blank"
              >
                <%= d.file_name %>
              </a>
            </li>
            <% }) %>
          </ul>
          <% } %>
        </div>
      </div>

      <!-- Payments Card -->
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Payments</h5>
          <% if (payments.length === 0) { %>
          <p class="text-muted mb-0">No payments recorded.</p>
          <% } else { %>
          <ul class="list-group list-group-flush">
            <% payments.forEach(p => { %>
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              <span>Amount: $<%= (p.amount_cents / 100).toFixed(2) %></span>
              <% if (p.status === 'SUCCESS' || p.status === 'Completed') { %>
              <span class="badge bg-success"><%= p.status %></span>
              <% } else if (p.status === 'Pending') { %>
              <span class="badge bg-warning text-dark"><%= p.status %></span>
              <% } else { %>
              <span class="badge bg-secondary"><%= p.status %></span>
              <% } %>
            </li>
            <% }) %>
          </ul>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
