<%- include('partials/header') %>

<div class="container mt-5">
  <div class="card shadow-sm p-4">
    <h2 class="card-title text-primary mb-4">Profile</h2>

    <!-- Alerts -->
    <% if (success) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert" id="success-alert">
        <%= success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% } %>
    <% if (error) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% } %>

    <form action="/profile/update" method="POST">
      <!-- Full Name -->
      <div class="mb-3">
        <label for="full_name" class="form-label">Full Name</label>
        <input type="text" class="form-control" id="full_name" name="full_name" value="<%= user.full_name || '' %>" required>
      </div>

      <!-- National ID (Citizens only) -->
      <% if (!user.department_id) { %>
      <div class="mb-3">
        <label for="national_id" class="form-label">National ID</label>
        <input type="text" class="form-control" id="national_id" name="national_id" value="<%= user.national_id || '' %>">
      </div>

      <!-- Date of Birth -->
      <div class="mb-3">
        <label for="date_of_birth" class="form-label">Date of Birth</label>
        <input 
          type="date" 
          class="form-control" 
          id="date_of_birth" 
          name="date_of_birth" 
          value="<%= user.date_of_birth ? new Date(user.date_of_birth).toISOString().split('T')[0] : '' %>">
      </div>

      <!-- Phone -->
      <div class="mb-3">
        <label for="phone" class="form-label">Contact Number</label>
        <input type="text" class="form-control" id="phone" name="phone" value="<%= user.phone || '' %>">
      </div>

      <% } else { %>
      <!-- Officer Fields -->
      <div class="mb-3">
        <label class="form-label">Department</label>
        <input type="text" class="form-control" value="<%= user.department_name || '' %>" disabled>
      </div>

      <div class="mb-3">
        <label for="job_title" class="form-label">Job Title</label>
        <input type="text" class="form-control" id="job_title" name="job_title" value="<%= user.job_title || '' %>">
      </div>
      <% } %>

      <button type="submit" class="btn btn-primary">Update Profile</button>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Auto hide success + redirect -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const successAlert = document.getElementById("success-alert");
    if (successAlert) {
      setTimeout(() => {
        // Fade out alert smoothly
        const alert = new bootstrap.Alert(successAlert);
        alert.close();

      }, 3000);
    }
  });
</script>
